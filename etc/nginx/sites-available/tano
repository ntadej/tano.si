server {
	listen 80;
	listen [::]:80;
	server_name tano.si;
	server_name www.tano.si;

	include /etc/nginx/snippets/letsencrypt.conf;

	return 301 https://tano.si$request_uri;

	access_log /var/log/nginx/default.access.log;
	error_log /var/log/nginx/default.error.log;
}

server {
	listen 443 ssl http2;
	listen [::]:443 ssl http2;
	server_name www.tano.si;

	include /etc/nginx/snippets/ssl.conf;

	return 301 https://tano.si$request_uri;

	access_log /var/log/nginx/default.access.log;
	error_log /var/log/nginx/default.error.log;
}

server {
	listen 443 ssl http2;
	listen [::]:443 ssl http2;
	server_name tano.si;
	root /var/www/default;
	index index.html;

	include /etc/nginx/snippets/ssl.conf;

	location = /oauth2/callback {
		proxy_intercept_errors on;
		proxy_pass http://oauth2;
	}

	location "~^/(?<target_host>[^/]+).tano.si/(?<remaining_uri>.*)$" {
		rewrite ^ http://$target_host.tano.si/$remaining_uri;
	}

	location / {
		try_files $uri $uri/ =404;
	}

	include /etc/nginx/snippets/error_pages.conf;
	include /etc/nginx/snippets/jekyll.conf;

	access_log /var/log/nginx/default.access.log;
	error_log /var/log/nginx/default.error.log;
}
